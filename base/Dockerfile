FROM ubuntu:22.04

# build-time arguments for builder
ARG OPEN5GS_VERSION="v2.7.2"

# install dependencies
RUN apt-get update && apt-get install python3-pip python3-setuptools python3-wheel ninja-build build-essential \
	flex bison git cmake libsctp-dev libgnutls28-dev libgcrypt-dev libssl-dev libidn11-dev libmongoc-dev \
	libbson-dev libyaml-dev libnghttp2-dev libmicrohttpd-dev libcurl4-gnutls-dev \
	libtins-dev libtalloc-dev meson -y

# clone the specific open5gs version and install it
RUN git clone --depth 1 --branch=${OPEN5GS_VERSION} https://github.com/open5gs/open5gs \
    && cd open5gs && meson build --prefix=`pwd`/install && ninja -j `nproc` -C build \
	&& cd build && ninja install
